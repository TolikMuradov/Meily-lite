<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ayarlar</title>
  <style>
    body { background-color: #1e1e1e; color: white; font-family: sans-serif; padding: 20px; }
    button { margin-top: 10px; padding: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Ayarlar</h2>
  <button onclick="setTheme('TokyoNight')">TokyoNight</button>
  <button onclick="setTheme('Catppuccin')">Catppuccin</button>
  <button onclick="setTheme('Gruvbox')">Gruvbox</button>
  <button onclick="setTheme('OneDark')">OneDark</button>

  <label>
    <input type="checkbox" id="transparentToggle">
    Arka planı şeffaf yap
  </label>


      <h3>Varsayılan Kategori Seç</h3>
    <select id="defaultCategorySelect"></select>
    <button onclick="updateDefaultCategory()">Uygula</button>
    <p id="categoryResultMsg" style="color: lightgreen;"></p>

  <script>
    const setTheme = (theme) => {
      window.api.setTheme(theme);
    };
  </script>
  <script>
    const checkbox = document.getElementById('transparentToggle');
    const saved = localStorage.getItem('transparentMode') === 'true';
    checkbox.checked = saved;
  
    checkbox.addEventListener('change', (e) => {
      const isChecked = e.target.checked;
      window.api.setTransparentMode(isChecked);
      localStorage.setItem('transparentMode', isChecked ? 'true' : 'false');
    });
  </script>


<script>
  const categorySelect = document.getElementById('defaultCategorySelect');
  const resultMsg = document.getElementById('categoryResultMsg');

  async function loadCategories() {
    const res = await fetch('http://52.65.1.213:8000/api/categories/');
    const data = await res.json();

    categorySelect.innerHTML = '';
    data.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat.id;
      option.textContent = cat.name;
      if (cat.name === 'Inbox') option.selected = true;
      categorySelect.appendChild(option);
    });
  }

  async function updateDefaultCategory() {
    const selectedId = categorySelect.value;

    // Tüm kategorileri çek ve diğerlerinin is_default'ını sıfırla
    const res = await fetch('http://52.65.1.213:8000/api/categories/');
    const data = await res.json();

    for (let cat of data) {
      const isDefault = parseInt(cat.id) === parseInt(selectedId);
      await fetch(`http://52.65.1.213:8000/api/categories/${cat.id}/`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: cat.name,
          is_default: isDefault
        })
      });
    }

    resultMsg.textContent = '✅ Varsayılan kategori güncellendi.';
  }

  loadCategories();
</script>

</body>
</html>
